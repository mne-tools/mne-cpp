name: DocuTest

on:
  push:
    branches:
    - <YourBranch>

  gh-pages:
    runs-on: ubuntu-latest
    needs: UpdateDevTag

    steps:
    - name: Clone repository
      uses: actions/checkout@v1
    - name: Setup Github credentials
      uses: fusion-engineering/setup-git-credentials@v2
      with:
        credentials: ${{secrets.GIT_CREDENTIALS}}
    - name: Clone doc/gh-pages into gh-pages branch
      run: |
        git config --global user.email dev@dev.com
        git config --global user.name dev
        cd mne-cpp
        git checkout --track -b gh-pages
        # Remove all files first
        git rm * -r
        git commit --amend -a -m 'Update docu' --allow-empty
        cd ..
        cp -RT doc/gh-pages mne-cpp
        cd mne-cpp
        git add .
        git commit --amend -a -m 'Update docu'
        git push -f --all